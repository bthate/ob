#!/usr/bin/env python3
# This file is placed in the Public Domain.

import os
import readline
import sys

from ob.run import Handler, Kernel, Restart, wrap

k = Kernel()
wd = os.path.expanduser("~/.ob")

class CLI(Handler):

    def error(self, e):
        print(e.exc)
        raise Restart

    def raw(self, txt):
        print(txt)

class Console(CLI):

    def handle(self, e):
        k.put(e)
        e.wait()

    def poll(self):
        return input("> ")

def main():
    k.cfg.p = "om"
    k.start()
    if k.cfg.txt:
        c = CLI()
        return k.cmd(c, k.cfg.otxt)
    if k.opts("c"):
        c = Console()
        c.start()
        k.wait()

wrap(main)

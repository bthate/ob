#!/usr/bin/env python3
# This file is placed in the Public Domain.

name = "ob"

from ob.clt import Client
from ob.krn import Kernel, Table, cfg, os, wrap
from ob.tbl import builtin

builtin("cfg", cfg)

class CLI(Client):

    def error(self, e):
        print(e.exc)
        raise Restart

    def raw(self, txt):
        print(txt)

def cmd(event):
    event.reply(",".join(sorted(Table.modules)))

def main():
    cfg.wd = os.path.expanduser("~/.%s" % name)
    Table.addcmd(cmd)
    k = Kernel()
    k.boot(name)
    k.start()
    if k.cfg.txt:
        c = CLI()
        return c.cmd(k.cfg.otxt)
    if k.cfg.mods:
        k.wait()

wrap(main)

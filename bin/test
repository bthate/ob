#!/usr/bin/env python3
# This file is placed in the Public Domain.

name = "ob"

from ob.bus import Bus
from ob.clt import Client
from ob.krn import Kernel, Table, os, wrap
from ob.obj import cfg
from ob.tbl import builtin

import doctest
import readline
import shutil
import unittest

flags = doctest.REPORT_NDIFF|doctest.FAIL_FAST|doctest.ELLIPSIS

class Test(Client):

    def raw(self, txt):
        if Kernel.opts("v"):
            print(txt)

def main():
    if os.path.exists(".test"):
        shutil.rmtree(".test")
    cfg.wd = ".test"
    cfg.debug = True
    k = Kernel()
    Kernel.cfg.pkgs = "ob,om,on,oe"
    k.boot(name)
    k.start()
    c = Test()
    c.start()
    pat = "test_%s*" % "*"
    suite = unittest.loader.TestLoader().discover("test", pattern=pat)
    unittest.TextTestRunner(verbosity=3).run(suite)
    doctest.testfile("../test/test1.txt", optionflags=flags, report=False, verbose=False)

wrap(main)

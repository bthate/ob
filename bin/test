#!/usr/bin/env python3
# This file is placed in the Public Domain.

import os
import ob
import sys

import doctest
import readline
import shutil
import unittest

from hdl import Handler
from run import Kernel, wrap

flags = doctest.REPORT_NDIFF|doctest.FAIL_FAST|doctest.ELLIPSIS
k = Kernel()
k.cfg.debug = True
k.cfg.verbose = True
k.cfg.p = "om"

class Test(Handler):

    def handle(self, e):
        k.put(e)

    def raw(self, txt):
        if k.opts("v"):
            print(txt)

def error(hdl, obj):
    print(obj.trc)

def main():
    if os.path.exists(".test"):
        shutil.rmtree(".test")
    k.error = error
    k.start(".test")
    c = Test()
    c.start()
    pat = "test_%s*" % "*"
    suite = unittest.loader.TestLoader().discover("test", pattern=pat)
    unittest.TextTestRunner(verbosity=3).run(suite)
    doctest.testfile("../test/test1.txt", optionflags=flags, report=False, verbose=False)

wrap(main)

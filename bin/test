#!/usr/bin/env python3
# This file is placed in the Public Domain.

from ob.clt import Client
from ob.krn import Kernel, Table, cfg, os, wrap
from ob.tbl import builtin

builtin("cfg", cfg)

import doctest
import readline
import shutil
import unittest

flags = doctest.REPORT_NDIFF|doctest.FAIL_FAST|doctest.ELLIPSIS
resume = {}

class Test(Client):

    def raw(self, txt):
        if Kernel.opts("v"):
            print(txt)

def main():
    if os.path.exists(".test"):
        shutil.rmtree(".test")
    cfg.debug = True
    cfg.wd = ".test"
    c = Test()
    c.start()
    k = Kernel()
    Kernel.cfg.pkgs = "ob,om,on,oe,od"
    k.boot("test")
    k.start()
    builtin("k", k)
    pat = "test_%s*" % "*"
    suite = unittest.loader.TestLoader().discover("test", pattern=pat)
    unittest.TextTestRunner(verbosity=3).run(suite)
    doctest.testfile("../test/test1.txt", optionflags=flags, report=False, verbose=False)

wrap(main)

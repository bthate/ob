#!/usr/bin/env python3
# This file is placed in the Public Domain.

import ob
import os
import readline
import sys

from hdl import Handler
from run import Kernel, wrap

d = os.path.expanduser("~/.ob")
k = Kernel()
k.cfg.p = "om"
k.cfg.m = "om.irc,om.rss"

class Console(Handler):

    def error(self, e):
        print(e.exc)
        raise Restart

    def handle(self, e):
        k.put(e)
        e.wait()

    def poll(self):
        return input("> ")

    def raw(self, txt):
        print(txt)

def main():
    k.start(d)
    c = Console()
    c.start()
    k.wait()

wrap(main)
